<html>
  <head>
    <title>Express HTML</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css"
    />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div style="margin:100px;">
      <nav class="navbar navbar-inverse navbar-static-top">
        <div class="container">
          <a class="navbar-brand" href="/">Express HTML</a>
          <ul class="nav navbar-nav">
            <li class="active">
              <a href="/">Home</a>
            </li>
            <li>
              <a href="/about">About</a>
            </li>
            <li>
              <a href="/sitemap">Sitemap</a>
            </li>
          </ul>
        </div>
      </nav>
      <div class="jumbotron" style="padding:40px;">
        <h1>Login/Signup</h1>
        <div>
          <input
            type="text"
            id="email"
            class="form-control mb-4"
            placeholder="Email"
          />
          <input
            type="password"
            id="password"
            class="form-control"
            placeholder="*******"
          />
          <button
            onclick="login('login')"
            type="button"
            class="btn btn-primary mb-4"
          >
            Login
          </button>
          <button
            onclick="login('signup')"
            type="button"
            class="btn btn-success"
          >
            Signup
          </button>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      let finalObj = {};
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        console.log(pair[0]);
        finalObj[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
        // if (decodeURIComponent(pair[0]) == variable) {
        //   return decodeURIComponent(pair[1]);
        // }
      }
      return finalObj;
    }
    async function login(url) {
      console.log(getQueryVariable("redirect_uri"));
      const queryParse = getQueryVariable();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const bodyObj = Object.assign({}, queryParse, {
        email,
        password
      });
      console.log(bodyObj, window.location.origin);
      const result = await fetch(`${window.location.origin}/${url}`, {
        method: "POST", // *GET, POST, PUT, DELETE, etc.
        mode: "cors", // no-cors, *cors, same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "same-origin", // include, *same-origin, omit
        headers: {
          "Content-Type": "application/json"
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        redirect: "follow", // manual, *follow, error
        referrerPolicy: "no-referrer", // no-referrer, *client
        body: JSON.stringify(bodyObj) // body data type must match "Content-Type" header
      });
      const resultJson = await result.json();
      console.log(resultJson);
      window.location.href =
        queryParse["redirect_uri"] +
        `?code=${resultJson.token}&state=${queryParse["state"]}`;
    }
    function signup() {
      window.location.href =
        getQueryVariable("redirect_uri") + "?code=aakau&state=xyz";
    }
  </script>
</html>
